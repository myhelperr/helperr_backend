{"version":3,"file":"errorHandler.js","sources":["middlewares/errorHandler.ts"],"sourceRoot":"/","sourcesContent":["import { NODE_ENV } from '../configs/envConfig';\r\nimport { Request, Response, NextFunction } from 'express';\r\n\r\ninterface CustomError extends Error {\r\n    statusCode: number;\r\n    status: string;\r\n    code?: number;\r\n    keyValue?: { [key: string]: any };\r\n    errors?: { [key: string]: any };\r\n}\r\n\r\nconst handleDuplicateKeyError = (err: CustomError): CustomError => {\r\n    const field = Object.keys(err.keyValue || {})[0];\r\n    const value = err.keyValue?.[field];\r\n    const message = `Duplicate value for ${field}: ${value}. Please use another value.`;\r\n\r\n    return {\r\n        ...err,\r\n        statusCode: 400,\r\n        status: 'fail',\r\n        message,\r\n    };\r\n};\r\n\r\nconst handleValidationError = (err: CustomError): CustomError => {\r\n    if (err.errors) {\r\n        const errorMessages: string[] = [];\r\n\r\n        for (const field in err.errors) {\r\n            const fieldError = err.errors[field];\r\n\r\n            // Handle enum validation errors dynamically\r\n            if (fieldError.kind === 'enum') {\r\n                const validValues = fieldError.properties?.enumValues || [];\r\n                const invalidValue = fieldError.value;\r\n                const message = `Invalid value '${invalidValue}' for field '${field}'. Allowed values are: ${validValues.join(', ')}.`;\r\n                errorMessages.push(message);\r\n            }\r\n            // Handle other validation errors\r\n            else if (fieldError.name === 'ValidatorError') {\r\n                errorMessages.push(\r\n                    fieldError.message || `Invalid value for field '${field}'.`,\r\n                );\r\n            }\r\n            // Handle any other validation errors\r\n            else if (fieldError.message) {\r\n                errorMessages.push(fieldError.message);\r\n            }\r\n        }\r\n\r\n        // If we have specific error messages, use them\r\n        if (errorMessages.length > 0) {\r\n            const message = errorMessages.join(' ');\r\n            return {\r\n                ...err,\r\n                statusCode: 400,\r\n                status: 'fail',\r\n                message,\r\n            };\r\n        }\r\n\r\n        // Fallback for other validation errors\r\n        const errors = Object.values(err.errors).map(\r\n            (val: any) => val.message || 'Validation error',\r\n        );\r\n        const message = `Invalid input data. ${errors.join('. ')}`;\r\n        return {\r\n            ...err,\r\n            statusCode: 400,\r\n            status: 'fail',\r\n            message,\r\n        };\r\n    }\r\n\r\n    return err;\r\n};\r\n\r\nconst sendDevError = (err: CustomError, res: Response): void => {\r\n    res.status(err.statusCode).send({\r\n        status: err.status,\r\n        message: err.message,\r\n        stack: err.stack,\r\n    });\r\n};\r\n\r\nconst sendProdError = (err: CustomError, res: Response): void => {\r\n    res.status(err.statusCode).send({\r\n        status: err.status,\r\n        message: err.message,\r\n    });\r\n};\r\n\r\nexport default (err: CustomError, _req: Request, res: Response, next: NextFunction) => {\r\n    const error = { ...err };\r\n\r\n    console.error('Error occured ğŸ¤¯ğŸ’¥:', error);\r\n    console.log(err);\r\n\r\n    // Handle MongoDB duplicate key error\r\n    if (err.code === 11000) {\r\n        err = handleDuplicateKeyError(err);\r\n    }\r\n\r\n    // Handle Mongoose validation errors (including enum validation)\r\n    if (err.name === 'ValidationError') {\r\n        err = handleValidationError(err);\r\n    }\r\n\r\n    err.statusCode = err.statusCode ?? 500;\r\n    err.message = err.message;\r\n    err.status = err.statusCode >= 400 && err.statusCode < 500 ? 'fail' : 'error';\r\n\r\n    NODE_ENV === 'prod' ? sendProdError(err, res) : sendDevError(err, res);\r\n\r\n    next();\r\n};\r\n"],"names":[],"mappings":"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","debug_id":"a0369193-8b4d-58d2-b166-75def06dbbbc"}